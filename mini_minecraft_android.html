<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Minecraft Ultra Light</title>
    <style>
        body { margin: 0; overflow: hidden; background: #87ceeb; font-family: sans-serif; touch-action: none; }
        canvas { display: block; width: 100%; height: 100%; }
        #ui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        
        /* Керування */
        .ctrl { position: absolute; pointer-events: auto; background: rgba(0,0,0,0.4); color: white; border: 1px solid #fff; border-radius: 5px; display: flex; align-items: center; justify-content: center; width: 50px; height: 50px; }
        #u { bottom: 120px; left: 70px; }
        #d { bottom: 20px; left: 70px; }
        #l { bottom: 70px; left: 20px; }
        #r { bottom: 70px; left: 120px; }
        
        /* Дії */
        .act { position: absolute; pointer-events: auto; border-radius: 50%; width: 70px; height: 70px; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 2px solid #fff; }
        #jmp { bottom: 20px; right: 110px; background: rgba(255,255,255,0.2); }
        #put { bottom: 100px; right: 20px; background: #4caf50; }
        #del { bottom: 20px; right: 20px; background: #f44336; }

        #inv { position: absolute; top: 10px; left: 50%; transform: translateX(-50%); display: flex; gap: 5px; pointer-events: auto; }
        .s { width: 35px; height: 35px; border: 1px solid #fff; background: #555; }
        .s.active { border: 3px solid yellow; }
    </style>
</head>
<body>

<div id="ui">
    <div id="inv">
        <div class="s active" onclick="window.setB(1)" style="background:#55ab33"></div>
        <div class="s" onclick="window.setB(4)" style="background:#5d4037"></div>
        <div class="s" onclick="window.setB(3)" style="background:#9e9e9e"></div>
        <div class="s" onclick="window.setB(6)" style="background:#2e7d32"></div>
    </div>
    <div class="ctrl" id="u">▲</div><div class="ctrl" id="l">◀</div>
    <div class="ctrl" id="r">▶</div><div class="ctrl" id="d">▼</div>
    <div class="act" id="jmp">JUMP</div>
    <div class="act" id="put">PUT</div>
    <div class="act" id="del">DEL</div>
</div>

<script type="importmap">
    { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
</script>

<script type="module">
    import * as THREE from 'three';

    let scene, camera, renderer, yaw, move = {f:0,b:0,l:0,r:0}, vel = 0, objects = [];
    let selB = 1, lastX = 0, lastY = 0;

    init();
    function init() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87ceeb);
        camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 100);
        yaw = new THREE.Object3D(); yaw.add(camera);
        yaw.position.set(5, 3, 5); scene.add(yaw);

        renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);
        scene.add(new THREE.AmbientLight(0xffffff, 2));

        // Створення простої підлоги
        for(let x=0; x<15; x++) {
            for(let z=0; z<15; z++) {
                const m = new THREE.Mesh(new THREE.BoxGeometry(1,1,1), new THREE.MeshLambertMaterial({color: 0x55ab33}));
                m.position.set(x, 0, z); scene.add(m); objects.push(m);
            }
        }

        const btn = (id, k, v) => {
            const el = document.getElementById(id);
            el.ontouchstart = (e) => { e.preventDefault(); move[k] = v; };
            el.ontouchend = (e) => { e.preventDefault(); move[k] = 0; };
        };
        btn('u','f',1); btn('d','b',1); btn('l','l',1); btn('r','r',1);
        
        document.getElementById('jmp').ontouchstart = () => { if(yaw.position.y < 2) vel = 0.2; };
        document.getElementById('put').ontouchstart = () => interact(true);
        document.getElementById('del').ontouchstart = () => interact(false);

        document.ontouchstart = e => { lastX = e.touches[0].clientX; lastY = e.touches[0].clientY; };
        document.ontouchmove = e => {
            if(e.target.tagName === 'DIV') return;
            yaw.rotation.y -= (e.touches[0].clientX - lastX) * 0.01;
            lastX = e.touches[0].clientX; lastY = e.touches[0].clientY;
        };

        window.setB = (id) => { 
            selB = id; 
            document.querySelectorAll('.s').forEach(s => s.classList.remove('active'));
            event.target.classList.add('active');
        };
        loop();
    }

    function interact(isPut) {
        const ray = new THREE.Raycaster();
        ray.setFromCamera({x:0, y:0}, camera);
        const h = ray.intersectObjects(objects);
        if(h.length > 0 && h[0].distance < 5) {
            if(isPut) {
                const p = h[0].object.position.clone().add(h[0].face.normal);
                const col = selB === 1 ? 0x55ab33 : (selB === 4 ? 0x5d4037 : 0x9e9e9e);
                const m = new THREE.Mesh(new THREE.BoxGeometry(1,1,1), new THREE.MeshLambertMaterial({color: col}));
                m.position.copy(p); scene.add(m); objects.push(m);
            } else {
                if(h[0].object.position.y > 0) {
                    scene.remove(h[0].object);
                    objects = objects.filter(o => o !== h[0].object);
                }
            }
        }
    }

    function loop() {
        requestAnimationFrame(loop);
        vel -= 0.01; yaw.position.y += vel;
        if(yaw.position.y < 1.8) { yaw.position.y = 1.8; vel = 0; }
        const s = 0.1;
        const f = new THREE.Vector3(0,0,-1).applyQuaternion(yaw.quaternion);
        const r = new THREE.Vector3(1,0,0).applyQuaternion(yaw.quaternion);
        if(move.f) yaw.position.add(f.multiplyScalar(s));
        if(move.b) yaw.position.add(f.multiplyScalar(-s));
        if(move.l) yaw.position.add(r.multiplyScalar(-s));
        if(move.r) yaw.position.add(r.multiplyScalar(s));
        renderer.render(scene, camera);
    }
</script>
</body>
</html>






